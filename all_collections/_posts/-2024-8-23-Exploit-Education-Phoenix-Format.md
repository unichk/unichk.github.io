---
title: "Exploit Education: Phoenix - Format"
date: 2024-8-23
categories: [exploit education]
---

# Format zero

> Can you change the "changeme" variable?

```c
...
int main(int argc, char **argv) {
    struct {
        char dest[32];
        volatile int changeme;
    } locals;
    char buffer[16];
...
    if (fgets(buffer, sizeof(buffer) - 1, stdin) == NULL) {
        errx(1, "Unable to get buffer");
    }
    buffer[15] = 0;

    locals.changeme = 0;

    sprintf(locals.dest, buffer);

    if (locals.changeme != 0) {
        puts("Well done, the 'changeme' variable has been changed!");
    } else {
        puts(
            "Uh oh, 'changeme' has not yet been changed. Would you like to try "
            "again?");
    }

    exit(0);
}
```

From the man page of `sprintf`, second argument is format, which is user input `buffer` in this case. 

```c
int sprintf(char *str, const char *format, ...);
sprintf(locals.dest, buffer);
```

payload: `%040x`

Therefore, if we put format string in `buffer`, it'll be substituted with whatever is in next parameter, hence the length of string copy into `local.dest` can be increased. Using `%040x` as payload will write the number in next parameter to `local.dest`, in hex with fixed length of 40 and zero padding in front, resulting in buffer overflow.

![image]({{site.baseurl}}/assets/images/Exploit-Education-Phoenix-Format/format-zero-success.png)

# Stack One

> Can you change the "changeme" variable?

```c
...
int main(int argc, char **argv) {
    struct {
        char dest[32];
        volatile int changeme;
    } locals;
    char buffer[16];
...
    if (fgets(buffer, sizeof(buffer) - 1, stdin) == NULL) {
        errx(1, "Unable to get buffer");
    }
    buffer[15] = 0;

    locals.changeme = 0;

    sprintf(locals.dest, buffer);

    if (locals.changeme != 0x45764f6c) {
        printf("Uh oh, 'changeme' is not the magic value, it is 0x%08x\n",
            locals.changeme);
    } else {
        puts("Well done, the 'changeme' variable has been changed correctly!");
    }

    exit(0);
}
```

payload: `%032xlOvE`

Similar to previous problem, use `%032x` to fill up `local.dest`, then the following `lOvE` (0x45764f6c) will be written into `changeme`.

![image]({{site.baseurl}}/assets/images/Exploit-Education-Phoenix-Format/format-one-success.png)